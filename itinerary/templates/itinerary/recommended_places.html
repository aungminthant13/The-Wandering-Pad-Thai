{% extends "itinerary/base.html" %}
{% block title %}Recommended Places{% endblock %}
{% block content %}

<!-- Navbar -->
<nav class="navbar">
  <div class="logo">
    <a href="{% url 'home' %}">
      <span class="logo-text">The Wandering Pad Thai</span>
    </a>
  </div>
  <button class="cancel-trip-btn" id="cancelTrip">Cancel</button>
</nav>

<section class="trip-form-section">
    <h1>Recommended Places for Your Trip</h1>

    <button id="fetchPlacesBtn" onclick="loadRecommendedPlaces()">Fetch Places</button>
    <p>Trip: {{ itinerary.name }}</p>

    <div id="loadingMessage" style="display: none;">Loading places...</div>
    
    <table id="placesTable" style="width:100%; border-collapse: collapse; display: none;">
        <thead>
            <tr>
                <th style="border: 1px solid black; padding: 8px;">#</th>
                <th style="border: 1px solid black; padding: 8px;">Name</th>
                <th style="border: 1px solid black; padding: 8px;">Latitude</th>
                <th style="border: 1px solid black; padding: 8px;">Longitude</th>
            </tr>
        </thead>
        <tbody id="placesList"></tbody>
    </table>

    <script>
        async function loadRecommendedPlaces() {
            const tripId = "{{ itinerary.id }}";
            const placesTable = document.getElementById("placesTable");
            const placesList = document.getElementById("placesList");
            const loadingMessage = document.getElementById("loadingMessage");
            
            placesTable.style.display = "none"; // Hide table initially
            loadingMessage.style.display = "block"; // Show loading message
            
            try {
                const response = await fetch(`/itinerary/trip/${tripId}/recommended/api/`);
                if (!response.ok) {
                    throw new Error("Failed to fetch places");
                }

                const data = await response.json();
                placesList.innerHTML = "";

                data.tourist_attractions.forEach((place, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td style="border: 1px solid black; padding: 8px;">${index + 1}</td>
                        <td style="border: 1px solid black; padding: 8px;">${place.name}</td>
                        <td style="border: 1px solid black; padding: 8px;">${place.lat}</td>
                        <td style="border: 1px solid black; padding: 8px;">${place.lng}</td>
                    `;
                    placesList.appendChild(row);
                });

                placesTable.style.display = "table"; // Show table
            } catch (error) {
                alert("Error fetching places. Please try again.");
                console.error(error);
            } finally {
                loadingMessage.style.display = "none"; // Hide loading message
            }
        }
    </script>
</section>

{% endblock %}
